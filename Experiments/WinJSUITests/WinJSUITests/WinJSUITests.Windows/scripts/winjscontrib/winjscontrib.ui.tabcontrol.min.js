/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";var e=WinJSContrib.UI.FluentDOM;WinJS.Namespace.define("WinJSContrib.UI",{TabPages:WinJS.Class.define(function(t,n){var a=this;n=n||{},a.element=t||document.createElement("div"),a.element.className="mcn-tabpages "+a.element.className,WinJSContrib.CrossPlatform&&WinJSContrib.CrossPlatform.crossPlatformClass&&WinJSContrib.CrossPlatform.crossPlatformClass(a.element),a.tabHeader=n.header||t.querySelector(".mcn-tabpages-header"),a.tabHeaderTemplate=n.headerTemplate,a.tabContent=n.content||t.querySelector(".mcn-tabpages-content"),a.tabLinkUri=n.uri,a.tabLinkArgs=n.args,a.tabs={"default":[]},a.tabContent||(a.tabContent=new e("DIV").addClass("mcn-tabpages-content").appendTo(a.element).element),a.tabWrapper=new e("DIV").addClass("mcn-tabpages-content-wrapper").appendTo(a.tabContent).element,a.navigator=new WinJSContrib.UI.PageControlNavigator(a.tabWrapper,{global:!1,delay:10,disableHistory:!0}),a.navigator.animationWaitForPreviousPageClose=!1,a.navigator.animations.exitPage=WinJSContrib.UI.Animation.tabExitPage,a.navigator.animations.enterPage=WinJSContrib.UI.Animation.tabEnterPage,a.tabHeader||(a.tabHeader=new e("DIV").addClass("mcn-tabpages-header").appendTo(a.element).element),a._createGroupHeader("default"),n.registerTabs&&a.registerTabs(),n.swipeSlide&&WinJSContrib.UI.SwipeSlide&&a.setSwipeSlideOnDefaultTab(n.rightbar)},{_createGroupHeader:function(e){var t=this;if(!t.tabs[e]||!t.tabs[e].tabGroup){var n=document.createElement("DIV");n.className="header-group-"+e+" mcn-tabpages-headergroup",t.tabs[e]||(t.tabs[e]=[]),t.tabs[e].tabGroup=n,t.tabHeader.appendChild(n)}},setSwipeRightbar:function(){var e=this;e.left="right",e.right="left"},setSwipeSlideOnDefaultTab:function(e){var t=this;e?t.setSwipeRightbar():(t.left="left",t.right="right"),t.swipeSlide=new WinJSContrib.UI.SwipeSlide(t.tabWrapper),t.navigator.animations.exitPage=function(e){return WinJSContrib.UI.Animation.fadeOut(e,{duration:100})},t.swipeSlide.onswipe=function(e){var n=t.swipeSlide.target.style;if(n.hasOwnProperty("webkitTransform")&&console.log("running on webkit"),t.swipeSlide.swipeHandled=!0,t.currentTab&&t.navigator.pageElement){var a=t.navigator.pageElement;a.style.transform=n.transform,n.hasOwnProperty("webkitTransform")&&(a.style.webkitTransform=n.webkitTransform,n.webkitTransform=""),n.transform="","left"===e.detail.direction?(a.winControl.getAnimationElements=function(){return null},WinJSContrib.UI.Animation.slideToLeft(a)):"right"===e.detail.direction&&(a.winControl.getAnimationElements=function(){return null},WinJSContrib.UI.Animation.slideToRight(a))}n.transform="",n.hasOwnProperty("webkitTransform")&&(n.webkitTransform=""),null==t.currentTab?t.selectFirst():"right"===e.detail.direction?(t.navigator.animations.enterPage=function(){return WinJSContrib.UI.Animation.slideFromLeft(t.tabWrapper)},t.selectByIndex(0==t.currentTab.index?t.tabs["default"].length-1:t.currentTab.index-1)):"left"===e.detail.direction&&(t.navigator.animations.enterPage=function(){return WinJSContrib.UI.Animation.slideFromRight(t.tabWrapper)},t.selectByIndex(t.currentTab.index==t.tabs["default"].length-1?0:t.currentTab.index+1))}},getPageLinkArgs:function(e){var t=this;return e.link.args||t.tabLinkArgs},getPageLink:function(e){var t=this;return e.link.uri||t.tabLinkUri?{uri:e.link.uri||t.tabLinkUri,args:t.getPageLinkArgs(e)}:null},selectFirst:function(e){return this.selectTab(this.tabs["default"][0],e)},selectTab:function(e,t,n){var a=this;if(e==a.currentTab)return WinJS.Promise.wrap(null);var r=a.getPageLink(e);if(!r)return WinJS.Promise.wrap(null);a.currentTab=e;var i=a.tabHeader.querySelector(".mcn-tabpages-headeritem.current");i&&WinJS.Utilities.removeClass(i,"current"),t||a.selectTabHeader();var s=$.extend({},n,r.args);return a.navigator.open(r.uri,s)},selectTabHeader:function(){var e=this;e.currentTab&&WinJS.Utilities.addClass(e.currentTab.element,"current")},selectByIndex:function(e,t,n,a){var r=this,i=r.tabs[n||"default"],s=i[e];return s?r.selectTab(s,t,a):WinJS.Promise.wrap(null)},selectByName:function(e,t,n,a){for(var r=this,i=r.tabs[n||"default"],s=0;s<i.length;s++){var o=i[s];if(o.item&&(o.item.id===e||o.item.name===e))return r.selectTab(o,t,a)}return WinJS.Promise.wrap(null)},selectByItem:function(e,t,n,a){for(var r=this,i=r.tabs[n||"default"],s=0;s<i.length;s++){var o=i[s];if(o.item==e)return r.selectTab(o,t,a)}return WinJS.Promise.wrap(null)},registerTabs:function(e,t){var n=this,a=n.tabs[t||"default"];a||(n._createGroupHeader(t),a=n.tabs[t]);for(var r=n.element.querySelectorAll(".mcn-tabpages-headeritem"),i=0;i<r.length;i++){var s=r[i];!function(e){var r={element:e,link:{uri:e.getAttribute("data-tabtarget")}};e.mcnTab=r,a.tabGroup.appendChild(e),r.index=a.length,r.group=t,a.push(r),WinJSContrib.UI.tap(r.element,function(){n.selectTab(r)})}(s)}},addTab:function(e,t){return this.addTabs([e],t)},addTabs:function(e,t){var n=this,a=n.tabs[t||"default"];a||(n._createGroupHeader(t),a=n.tabs[t]);var r=a.tabGroup,i=n.tabHeaderTemplate;return i&&(i=WinJSContrib.Utils.getTemplate(i)),WinJSContrib.Promise.waterfall(e,function(e){var s=document.createElement("DIV");s.className="mcn-tabpages-headeritem",r.appendChild(s);var o={element:s,item:e,link:{uri:e.uri||e.href||n.tabLinkUri,args:e.args||null,oninvoked:e.invoked}};return s.mcnTab=o,o.index=a.length,o.group=t,a.push(o),WinJSContrib.UI.tap(s,function(){o.link.oninvoked?o.link.oninvoked(n,o):n.selectTab(o)}),i.render(e).then(function(e){for(;e.children.length>0;)s.appendChild(e.children[0])})})}})})}();