/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{HubControl:WinJS.Class.define(function(t,e){var n=this;if(e=e||{},n.element=t,n.savestate=void 0!=e.savestate?e.savestate:!0,n.scrollContainer=e&&e.scrollContainer?e.scrollContainer:t,n.sectionsContainer=e&&e.sectionsContainer?e.sectionsContainer:t.querySelector(".mcn-hub-surface"),!n.sectionsContainer){for(n.sectionsContainer=document.createElement("DIV"),n.sectionsContainer.className="mcn-hub-surface";t.children[0];)n.sectionsContainer.appendChild(t.children[0]);t.appendChild(n.sectionsContainer)}n.element.className=n.element.className+" mcn-hub-ctrl mcn-layout-ctrl win-disposable",n.element.winControl=n,n.sections=[],n.multipass=e.multipass,n.hubScrolledBind=n.hubScrolled.bind(n),n.rendering={lastScroll:0},n.identifier=n.element.id+"//"+n.element.className;var i=WinJSContrib.Utils.getScopeControl(n.element);i&&i.pageLifeCycle?(i.pageLifeCycle.steps.layout.attach(function(){n.layout()}),i.pageLifeCycle.steps.ready.attach(function(){n.savestate&&n.restoreCtrlState(),n.prepare()})):i&&i.elementReady&&i.elementReady.then(function(){i.readyComplete.then(function(){n.layout(),n.savestate&&n.restoreCtrlState(),n.prepare()})})},{prepare:function(){this.autoRegisterSections()},multipass:{get:function(){return this._multipass},set:function(t){this._multipass=t}},orientation:{get:function(){return this._orientation},set:function(t){this._orientation=t}},autoRegisterSections:function(){var t=this;t.sections=[];for(var e=t.scrollContainer.querySelectorAll(".mcn-hub-section"),n=0;n<e.length;n++){var i=e[n],o=i.winControl;o&&t.sections.push(o)}},registerSection:function(t,e){var n=new Section(t,e);return this.sections.push(n),n},layout:function(t){var e=this;e.element.style.display="";var n=document.createElement("DIV");n.className="mcn-hub-section-spacer",e.sectionsContainer.appendChild(n),e.sections.length||e.autoRegisterSections(),this.sections.forEach(function(n){n.hub=e,n.layout(t),n._attachItemsControls()})},_attachItemsControls:function(){var t=this;t.sections.forEach(function(e){e.hub=t,e._attachItemsControls()})},renderItemsContent:function(t){var e=this;e.rendering.size={width:e.scrollContainer.clientWidth,height:e.scrollContainer.clientHeight},e.multipass||e.sections.forEach(function(n){n.hub=e,n.renderItemsContent(t)})},renderSection:function(t,e,n){var i=this;return t.hub=i,new WinJS.Promise(function(o,s){var r=WinJSContrib.Utils.getTemplate(e);if(r){var l=document.createElement("DIV");n&&(l.className="mcn-hub-section-titled"),r.render(t).done(function(t){for(var e=new WinJSContrib.UI.HubSection(l);t.children[0];)l.appendChild(t.children[0]);i.sectionsContainer.appendChild(l),i.sections.push(e),o(e)})}})},removeSection:function(t){var e=this,n=e.sections.indexOf(val);n>-1&&e.sections.splice(n,1)},saveCtrlState:function(){var t=this,e=WinJSContrib.UI.parentNavigator(t.element);if(e){var n=e.history,i=n.current.state||{hub:{}};if(i.hub||(i.hub={}),t.scrollContainer){var o={};o.scrollLeft=t.scrollContainer.scrollLeft,o.scrollTop=t.scrollContainer.scrollTop,i.hub[t.identifier]=o}n.current.state=i}return i},restoreCtrlState:function(t){var e=this,n=WinJSContrib.UI.parentNavigator(e.element);if(n){var i=n.history;if(t=t||i.current.state||{hub:{}},t.hub||(t.hub={}),e.scrollContainer&&t.hub){var o=t.hub[e.identifier];o&&o.scrollLeft&&(e.scrollContainer.scrollLeft=o.scrollLeft),o&&o.scrollTop&&(e.scrollContainer.scrollTop=o.scrollTop)}}},hubScrolled:function(){this.rendering.size||(this.rendering.size={width:this.scrollContainer.clientWidth,height:this.scrollContainer.clientHeight});var t=this.scrollContainer.scrollLeft||this.scrollContainer.scrollTop,e=Math.abs(t-this.rendering.lastScroll);e>this.multipassStrategy.scrollOffset&&(this.multipassStrategy.processSections(this),this.rendering.lastScroll=t)},exitPage:function(){this.savestate&&this.saveCtrlState()},updateLayout:function(t,e,n){var i=this,o={w:i.scrollContainer.clientWidth,h:i.scrollContainer.clientHeight};!i.LastLayoutState||i.LastLayoutState.w==o.w&&i.LastLayoutState.h==o.h||(i.scrollContainer.scrollLeft=0,i.scrollContainer.scrollTop=0),i.LastLayoutState=o},dispose:function(){var t=this;t.scrollContainer.removeEventListener("scroll",t.hubScrolledBind),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})}),WinJS.Namespace.define("WinJSContrib.UI",{HubSection:WinJS.Class.define(function(t,e){var n=this;e=e||{},n.element=t||document.createElement("DIV"),n.element.winControl=n,n.element.className=n.element.className+" mcn-hub-section win-disposable",n.onlayout=e.onlayout},{layout:function(t){var e=this,n=e.element.querySelectorAll(".mcn-layout-ctrl");if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i].winControl;o&&(o.multipass=o.multipass||e.multipass)}e.onlayout&&e.onlayout(t)},_attachItemsControls:function(){var t=this,e=this.element.querySelectorAll(".mcn-items-ctrl");if(e&&e.length)for(var n=0;n<e.length;n++){var i=e[n].winControl;i&&(i.multipass=t.hub.multipass,void 0==i.scrollContainer&&(i.scrollContainer=t.hub.scrollContainer))}},renderItemsContent:function(){var t=this.element.querySelectorAll(".mcn-items-ctrl");if(t&&t.length)for(var e=0;e<t.length;e++){var n=t[e].winControl;n&&n.renderItemsContent&&n.renderItemsContent()}},dispose:function(){WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})}),WinJSContrib.UI.WebComponents&&(WinJSContrib.UI.WebComponents.register("mcn-hub",WinJSContrib.UI.HubControl,{properties:["multipass"]}),WinJSContrib.UI.WebComponents.register("mcn-hub-section",WinJSContrib.UI.HubSection,{properties:[]}))}();