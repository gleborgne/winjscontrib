/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";var e="&#57570;",t="&#57571;";WinJS.Namespace.define("WinJSContrib.UI",{FlipView:WinJS.Class.mix(WinJS.Class.define(function(n,i){var s=this;this.element=n||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("mcn-flipview"),this.element.classList.add("win-disposable"),this._pages=[],this.pagesBuffer=2,this._currentPage=0,this._itemTemplate=null,this._items=null,this.wrapper=document.createElement("DIV"),this.wrapper.className="mcn-flipview-wrapper",this.element.appendChild(this.wrapper),this.pagesContainer=document.createElement("DIV"),this.pagesContainer.className="mcn-flipview-pages",this.wrapper.appendChild(this.pagesContainer),this.buttonsContainer=document.createElement("DIV"),this.buttonsContainer.className="mcn-flipview-buttons",this.wrapper.appendChild(this.buttonsContainer),this.navLeft=document.createElement("BUTTON"),this.navLeft.className="mcn-nav-button win-navleft hidden",this.navLeft.innerHTML=e,this.buttonsContainer.appendChild(this.navLeft),this.navLeft.onclick=function(){s.goPrevious()},this.navRight=document.createElement("BUTTON"),this.navRight.className="mcn-nav-button win-navright hidden",this.navRight.innerHTML=t,this.navRight.onclick=function(){s.goNext()},this.buttonsContainer.appendChild(this.navRight),WinJS.UI.setOptions(this,i)},{itemTemplate:{get:function(){return this._itemTemplate},set:function(e){e.winControl&&(e=e.winControl),this._itemTemplate=e,this._destroyAllPages(),this.moveToPageIndex(this._currentPage)}},items:{get:function(){return this._items},set:function(e){this._items=e,this._destroyAllPages(),this.moveToPageIndex(this._currentPage)}},currentPage:{get:function(){return this._currentPage},set:function(e){e!=this._currentPage&&this.moveToPageIndex(e)}},goPrevious:function(){var e=this,t=e._pages[e._currentPage];t&&e._exitPage(t,WinJSContrib.UI.Animation.slideToRight),e.moveToPageIndex(e._currentPage-1)},goNext:function(){var e=this,t=e._pages[e._currentPage];t&&e._exitPage(t,WinJSContrib.UI.Animation.slideToLeft),e.moveToPageIndex(e._currentPage+1)},_exitPage:function(e,t){e&&e.element&&(e.element.classList.remove("selected"),t(e.element).then(function(){e.element&&e.element.classList.add("hidden")}))},moveToPageIndex:function(e){var t=this;0>e&&(e=0),t.items&&e>=t.items.length&&(e=t.items.length-1);var n=t._currentPage;this._currentPage=e;var i=this._currentPage-n;if(t.itemTemplate&&t.items){var s=t.items[t._currentPage];if(s){var a=t._createPage(s,t._currentPage);a.element.style.opacity="",a.element.classList.remove("hidden"),a.element.classList.add("selected"),i>0?WinJSContrib.UI.Animation.slideFromRight(a.element).then(function(){a.cleanTransform()}):0>i&&WinJSContrib.UI.Animation.slideFromLeft(a.element).then(function(){a.cleanTransform()}),t.dispatchEvent("pageselected",{currentPage:t._currentPage}),setImmediate(function(){t._cleanPages(),t.preparePreviousPage(t._currentPage-1),t.prepareNextPage(t._currentPage+1)}),0==t._currentPage?t.navLeft.classList.add("hidden"):t.navLeft.classList.remove("hidden"),t._currentPage>=t._items.length-1?t.navRight.classList.add("hidden"):t.navRight.classList.remove("hidden")}}},preparePreviousPage:function(e){var t=this;if(!(0>e)&&t.items&&t.items.length){var n=t.items[e];if(n){t._createPage(n,e)}}},prepareNextPage:function(e){var t=this;if(t.items&&t.items.length&&!(e>=t.items.length)){var n=t.items[e];if(n){t._createPage(n,e)}}},_cleanPages:function(){var e=this;if(e._pages&&e._pages.length){var t=e._currentPage-e.pagesBuffer,n=e._currentPage+e.pagesBuffer;e._pages.forEach(function(i,s){i&&(t>s||s>n)&&(i.dispose(),e._pages[s]=null)})}},_destroyAllPages:function(){this._pages&&this._pages.length&&this._pages.forEach(function(e){e&&e.dispose()}),this.pagesContainer.innerHTML="",this._pages=[]},_createPage:function(e,t){var n=this;if(n._pages[t])return n._pages[t];var i={element:document.createElement("DIV"),swipeslide:null,index:t,contentPromise:null,eventTracker:new WinJSContrib.UI.EventTracker,cleanTransform:function(){this.element&&(this.element.style.webkitTransform?(this.element.style.webkitTransition="",this.element.style.webkitTransform=""):(this.element.style.transition="",this.element.style.transform=""))},dispose:function(){this.eventTracker.dispose(),this.element&&n.pagesContainer.removeChild(this.element),this.element=null}};i.element.className="mcn-flipview-page win-disposable hidden",n.pagesContainer.appendChild(i.element);var s=new WinJSContrib.UI.SwipeSlide(i.element);i.swipeslide=s,i.element.winControl=i,i.eventTracker.addEvent(s,"swipe",function(e){"left"==e.direction&&s.allowed.left?(console.log("swipe to left"),s.swipeHandled=!0,n._exitPage(i,WinJSContrib.UI.Animation.slideToLeft),n.currentPage=n.currentPage+1):"right"==e.direction&&s.allowed.right&&(console.log("swipe to right"),s.swipeHandled=!0,n._exitPage(i,WinJSContrib.UI.Animation.slideToRight),n.currentPage=n.currentPage-1)}),0==t&&(i.swipeslide.allowed.right=!1),t==n.items.length-1&&(i.swipeslide.allowed.left=!1);var a=null;return a="function"==typeof n.itemTemplate?n.itemTemplate(WinJS.Promise.wrap({index:t,data:e})):n.itemTemplate.render(e),i.contentPromise=a.then(function(e){i.element.appendChild(e)}),n._pages[t]=i,i},dispose:function(){WinJS.Utilities.disposeSubTree(this.element),this.element=null}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("pageselected"))})}();