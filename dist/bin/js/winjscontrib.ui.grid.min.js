/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{GridControl:WinJS.Class.define(function(e,t){var i=this;t=t||{},i.element=e,i.element.className=i.element.className+" mcn-grid-ctrl mcn-layout-ctrl win-disposable",i.element.winControl=i,i.renderer=new WinJSContrib.UI.MultiPassRenderer(i.element,{multipass:t.multipass,itemClassName:t.itemClassName,itemTemplate:t.itemTemplate,itemInvoked:t.itemInvoked}),i.layouts=t.layouts,i.defaultLayout={layout:t.layout||"none",itemsPerColumn:t.itemsPerColumn?t.itemsPerColumn:void 0,itemsPerRow:t.itemsPerRow?t.itemsPerRow:void 0,cellSpace:t.cellSpace?t.cellSpace:10,cellWidth:t.cellWidth?t.cellWidth:void 0,cellHeight:t.cellHeight?t.cellHeight:void 0},i.autolayout=t.autolayout||!0;var l=WinJSContrib.Utils.getScopeControl(i.element);l&&l.pageLifeCycle?l.pageLifeCycle.steps.layout.attach(function(){i.autolayout&&i.layout()}):l&&l.elementReady&&l.elementReady.then(function(){l.readyComplete.then(function(){i.autolayout&&i.layout()})})},{scrollContainer:{get:function(){return this.renderer.scrollContainer},set:function(e){this.renderer.scrollContainer=e}},autolayout:{get:function(){return this._autolayout},set:function(e){this._autolayout=e}},layouts:{get:function(){return this.gridLayouts},set:function(e){this.gridLayouts=e}},multipass:{get:function(){return this.renderer.multipass},set:function(e){this.renderer.multipass=e}},itemInvoked:{get:function(){return this.renderer.itemInvoked},set:function(e){this.renderer.itemInvoked=e}},itemTemplate:{get:function(){return this.renderer.itemTemplate},set:function(e){this.renderer.itemTemplate=e}},itemClassName:{get:function(){return this.renderer.itemClassName},set:function(e){this.renderer.itemClassName=e}},items:{get:function(){},set:function(e){e&&e.length&&this.prepareItems(e)}},prepareItems:function(e,t){if(this.element){var i=WinJSContrib.Utils.getParentControlByClass("mcn-layout-ctrl",this.element);!this.renderer.multipass&&i&&i.multipass&&(this.renderer.multipass=i.multipass),this.renderer.prepareItems(e,t)}},renderItemsContent:function(){this.renderer&&this.renderer.renderItemsContent()},resetElement:function(e,t){var i=e.style;t&&i.position&&(i.position=""),!t&&i.display&&(i.display=""),i.width&&(i.width=""),i.height&&(i.height=""),i.minWidth&&(i.minWidth=""),i.minHeight&&(i.minHeight=""),i.left&&(i.left=""),i.top&&(i.top="")},clearContent:function(){var e=this;e.renderer.clear()},clearLayout:function(){var e=this;if(e.resetElement(e.element,!1),e.element.children.length)for(var t=0,i=e.element.children.length;i>t;t++)e.resetElement(e.element.children[t],!0)},fill:function(e,t,i,l,n){if(e.length<t+l)for(var a=e.length;t+l>a;a++)e.push([]);for(var a=t;t+l>a;a++){var r=e[a];if(r.length<i+n)for(var o=r.length;i+n>o;o++)r.push(!1);for(var o=i;i+n>o;o++)r[o]=!0}},fit:function(e,t,i,l,n,a,r){if(r&&n>r&&0===i)return!0;if(a&&l>a&&0===t)return!0;if(a&&t+l>a)return!1;if(r&&i+n>r)return!1;for(var o=t;t+l>o;o++){var s=e[o];if(s)for(var d=i;i+n>d;d++)if(s[d]===!0)return!1}return!0},firstFit:function(e,t,i,l,n){for(var a=this,r=0;n*l*2>r;r++){var o=e[r];if(!o)return{x:r,y:0};for(var s=0;l>s;s++)if(o[s]!==!0&&a.fit(e,r,s,t,i,void 0,l))return{x:r,y:s}}return void 0},visibleChilds:function(){for(var e=this,t=[],i=0,l=e.element.children.length;l>i;i++){var n=e.element.children[i],a=window.getComputedStyle(n);"none"!=a.display&&"hidden"!=a.visibility&&t.push(n)}return t},GridLayoutsImpl:{none:function(){},flexhorizontal:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="column wrap",e.element.style.alignContent="flex-start",e.element.style.width&&(e.element.style.width=""),e.element.style.height="",e.element.style.height=e.element.clientHeight?e.element.clientHeight+"px":"";var t=Math.floor(e.element.clientHeight/(e.data.cellHeight+e.data.cellSpace));if(t){var i=e.visibleChilds(),l=Math.ceil(i.length/t);e.element.style.minWidth=(e.data.cellWidth+e.data.cellSpace)*l+"px"}},flexvertical:function(){var e=this;e.renderer.orientation="vertical",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="row wrap",e.element.style.alignContent="flex-start",e.element.style.width="",e.element.style.width=e.element.clientWidth?e.element.clientWidth+"px":"",e.element.style.height&&(e.element.style.height="")},hbloc:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.height="";var t=e.element.clientHeight;if(t){var i=e.data.cellWidth,l=e.data.cellSpace,n=1,a=0,r=0,o=e.visibleChilds();o.forEach(function(e){"absolute"!=e.style.position&&(e.style.position="absolute");var o=e.clientHeight;r+o>t&&(n++,a=a+l+i,r=0),e.style.left!=a+"px"&&(e.style.left=a+"px"),e.style.top!=r+"px"&&(e.style.top=r+"px"),r+=o}),a+=i,e.element.style.width!=a+"px"&&(e.element.style.width=a+"px")}},horizontal:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.height="";var t=e.element.clientHeight;if(t){var i=Math.floor(t/(e.data.cellHeight+e.data.cellSpace));0>=i&&(i=1);var l=e.data.cellWidth,n=e.data.cellHeight,a=e.data.cellSpace,r=1,o=1;e.data.itemsPerColumn&&(i=e.data.itemsPerColumn,n=(t-(i-1)*a)/i>>0,l=e.data.cellWidth*n/e.data.cellHeight>>0,r=l/e.data.cellWidth,o=n/e.data.cellHeight);var s=[[]],d=e.visibleChilds();d.forEach(function(t){t.style.position="absolute";var d=t.offsetWidth*r,h=t.offsetHeight*o,c=d/l>>0,u=h/n>>0,m=e.firstFit(s,c,u,i,e.element.children.length);m||(m={x:0,y:0}),e.fill(s,m.x,m.y,c,u);var f=m.x*(l+a),y=m.y*(n+a),p=c*l+(c-1)*a,v=u*n+(u-1)*a;t.style.left=f+"px",t.style.top=y+"px",t.style.width=p+"px",t.style.height=v+"px"});var h=s.length*(l+a);e.element.style.width=h+"px"}},vertical:function(e){var t=this;t.renderer.orientation="vertical",t.element.style.width="",t.element.style.position="relative";var i=t.element.clientWidth;if(i){var l=Math.floor(i/(t.data.cellWidth+t.data.cellSpace));0>=l&&(l=1);var n=t.data.cellWidth,a=t.data.cellHeight,r=t.data.cellSpace,o=1,s=1;t.data.itemsPerRow&&(l=t.data.itemsPerRow,n=(i-(l-1)*r)/l>>0,a=t.data.cellHeight*n/t.data.cellWidth>>0,o=n/t.data.cellWidth,s=a/t.data.cellHeight);var d=[[]],h=t.visibleChilds();h.forEach(function(e){e.style.position="absolute";var i=e.offsetWidth*o,h=e.offsetHeight*s,c=i/n>>0,u=h/a>>0,m=t.firstFit(d,u,c,l,t.element.children.length);t.fill(d,m.x,m.y,u,c);var f=m.y*(n+r),y=m.x*(a+r);e.style.left=f+"px",e.style.top=y+"px",e.style.width=c*n+(c-1)*r+"px",e.style.height=u*a+(u-1)*r+"px"});var c=d.length*(a+r);t.element.style.height=c+"px"}}},layout:function(){var e=this;if(e.element){var t=e.data;if(e.data=e.getLayout(),e.data){if(e.data.cellSpace=void 0!=e.data.cellSpace?e.data.cellSpace:void 0!=e.defaultLayout.cellSpace?e.defaultLayout.cellSpace:10,e.data.cellWidth=e.data.cellWidth||e.defaultLayout.cellWidth||0,e.data.cellHeight=e.data.cellHeight||e.defaultLayout.cellHeight||0,(!e.data.cellWidth||!e.data.cellHeight)&&e.element&&e.element.childNodes&&e.element.children.length>0){var i=e.visibleChilds();if(i&&i.length){var l=i[0],n=l.clientWidth,a=l.clientHeight,r=i.length;r>10&&(r=10);for(var o=0,r=i.length;r>o;o++){var s=i[o];(0==n||s.clientWidth<n)&&(n=s.clientWidth),(0==a||s.clientHeight<a)&&(a=s.clientHeight)}e.data.cellWidth=n,e.data.cellHeight=a}}var d=!t||e.data.layout!==t.layout;if(e.data.layout){var h=e.GridLayoutsImpl[e.data.layout.toLowerCase()];h&&(d&&e.changeLayout(),h.bind(e)(d),e.data.applyed=!0)}e.renderer.checkRendering()}}},changeLayout:function(){var e=this;e.clearLayout(),e.renderer.updateLayout()},updateLayout:function(e,t,i){var l=this;l.element&&l.layout()},getLayout:function(){var e=this,t=void 0;if(e.gridLayouts)for(var i in e.gridLayouts){var l=e.gridLayouts[i];if(e.gridLayouts.hasOwnProperty(i))if(l.query){var n=window.matchMedia(l.query);n.matches&&(t=l)}else t||(t=l);else t||(t=l)}return t||(t=e.defaultLayout),JSON.parse(JSON.stringify(t))},dispose:function(){this.element=null,this.renderer.dispose(),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})}),WinJSContrib.UI.WebComponents&&WinJSContrib.UI.WebComponents.register("mcn-grid",WinJSContrib.UI.GridControl,{properties:["multipass","autolayout","layouts","itemInvoked","itemTemplate","itemClassName","items"]})}();