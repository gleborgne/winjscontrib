/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},WinJSContrib;!function(t){var e;!function(e){var n=function(){function e(e,n){var i=this;this.element=e||document.createElement("DIV"),n=n||{},this.element.winControl=this,this.element.classList.add("mcn-datepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-datepicker-flyout"),this.element.appendChild(this.flyout.element),this.flyout.onbeforeshow=function(){setImmediate(function(){i.calendar.focusSelected()})},n.hasOwnProperty("deferRendering")||(n.deferRendering=!0);var a=document.createElement("DIV");this.flyout.element.appendChild(a);var r=JSON.parse(JSON.stringify(n));r.flyout=this.flyout,this.calendar=new t.UI.Calendar(a,r),this.calendar.onchange=function(){i.value=i.calendar.value,i.dispatchEvent("change")},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-datepicker-text tap",this.element.appendChild(this.textElement),this.textElement.tabIndex=0,this.textElement.setAttribute("role","button"),this.textElement.onclick=function(t){t.preventDefault(),t.stopPropagation(),i.flyout.show(i.textElement)},WinJS.UI.setOptions(this,n),this.value||(this.value=new Date)}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.calendar.value=t,this.textElement.innerText=moment(t).format("ll"),this.flyout.hide()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e}();e.DatePickerControl=n,e.DatePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(n),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var i=function(){function e(e,n){var i=this;if(this.element=e||document.createElement("DIV"),n=n||{},this._startDayOfWeek=1,this.eventTracker=new t.UI.EventTracker,this.element.winControl=this,this.element.classList.add("mcn-calendar"),this.element.classList.add("win-disposable"),WinJS.UI.setOptions(this,n),this.flyout&&(this.element.classList.add("win-xyfocus-suspended"),this.eventTracker.addEvent(this.element,"keydown",this.onkeydown.bind(this),!0)),this._ready=!1,n.deferRendering){var a=t.Utils.getScopeControl(this.element);a?a.readyComplete&&a.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){i.render()},WinJS.Utilities.Scheduler.Priority.idle)}):setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){i.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){"string"==typeof t&&(t=moment(t).toDate()),this._value=t,this._currentPanel&&(this._currentPanel._currentDate=new Date(t.getFullYear(),t.getMonth(),1),this._currentPanel.ensureValue())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDayOfWeek",{get:function(){return this._startDayOfWeek},set:function(t){this._startDayOfWeek=t},enumerable:!0,configurable:!0}),e.prototype.focusSelected=function(){var t=this.element.querySelector(".day-item.selected");t&&t.focus()},e.prototype.getFocusedDay=function(){var t=this.element.querySelector("*:focus");if(t.classList.contains("day-item")){var e=t.mcnCalendarDay;return e}},e.prototype.onkeydown=function(t){if("PageDown"==t.key)this._currentPanel.next(!0),t.preventDefault(),t.stopPropagation();else if("PageUp"==t.key)this._currentPanel.previous(!0),t.preventDefault(),t.stopPropagation();else if("Down"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("down",{focusRoot:this.element});e?e.focus():this._currentPanel.next(!0),t.preventDefault(),t.stopPropagation()}else if("Up"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("up",{focusRoot:this.element});e?e.focus():this._currentPanel.previous(!0),t.preventDefault(),t.stopPropagation()}else if("Left"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("left",{focusRoot:this.element});e&&e.focus(),t.preventDefault(),t.stopPropagation()}else if("Right"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("right",{focusRoot:this.element});e&&e.focus(),t.preventDefault(),t.stopPropagation()}},e.prototype.render=function(){var e=this;if(!this._ready){this._ready=!0,this.wrapper=document.createElement("DIV"),this.wrapper.className="mcn-calendar-wrapper",this.element.appendChild(this.wrapper),this.panelsContainer=document.createElement("DIV"),this.panelsContainer.className="mcn-calendar-panels",this.wrapper.appendChild(this.panelsContainer),this.navbuttons=document.createElement("DIV"),this.navbuttons.className="navbuttons",this.wrapper.appendChild(this.navbuttons),this.navbuttonPrevious=document.createElement("BUTTON"),this.navbuttonPrevious.className="navbutton navbutton-previous",this.navbuttons.appendChild(this.navbuttonPrevious),t.UI.tap(this.navbuttonPrevious,function(){e._currentPanel&&e._currentPanel.previous()}),this.navbuttonNext=document.createElement("BUTTON"),this.navbuttonNext.className="navbutton navbutton-next",this.navbuttons.appendChild(this.navbuttonNext),t.UI.tap(this.navbuttonNext,function(){e._currentPanel&&e._currentPanel.next()});var n=this.value;n||(n=this.mindate?moment(this.mindate).toDate():new Date),this._daysPanel=new r(this,n),this._currentPanel=this._daysPanel,this._currentPanel.currentChanged=function(){e.checkState()},this.checkState(),this.element.onmousewheel=function(t){t.preventDefault(),t.stopPropagation(),t.wheelDelta<0?e._currentPanel.allowNext()&&e._currentPanel.next():e._currentPanel.allowPrevious()&&e._currentPanel.previous()},this._currentPanel.setNavButtonsLabels()}},e.prototype.checkState=function(){this.navbuttonNext.disabled=this._currentPanel.allowNext()?!1:!0,this.navbuttonPrevious.disabled=this._currentPanel.allowPrevious()?!1:!0},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e.prototype.switchToMonth=function(){this._currentPanel!=this._monthsPanel&&this._currentPanel.hide(),this._monthsPanel?(this._monthsPanel._currentDate=this._currentPanel._currentDate,this._monthsPanel.ensureValue(!0)):this._monthsPanel=new s(this,this._currentPanel._currentDate),this._monthsPanel.show(),this._currentPanel=this._monthsPanel,this.checkState(),this._currentPanel.setNavButtonsLabels()},e.prototype.switchToDays=function(){this._currentPanel!=this._daysPanel&&this._currentPanel.hide(),this._daysPanel._currentDate=this._currentPanel._currentDate,this._daysPanel.ensureValue(!0),this._daysPanel.show(),this._currentPanel=this._daysPanel,this.checkState(),this._currentPanel.setNavButtonsLabels()},e.prototype.dispose=function(){this.eventTracker.dispose(),WinJS.Utilities.disposeSubTree(this.element)},e}();e.CalendarControl=i,e.Calendar=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(i),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var a=function(){function t(t,e){this.parent=t,this.element=document.createElement("DIV"),this.element.className="calendar-panel",this.element.tabIndex=-1,this.parent.panelsContainer.appendChild(this.element),this._currentDate=new Date(e.getFullYear(),e.getMonth(),1)}return t.prototype.next=function(t){},t.prototype.previous=function(t){},t.prototype.allowNext=function(){return!1},t.prototype.allowPrevious=function(){return!1},t.prototype.ensureValue=function(t,e){},t.prototype.hide=function(){var t=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){t.element.classList.add("disabled")})},t.prototype.show=function(){return this.element.classList.remove("disabled"),WinJS.UI.Animation.drillInIncoming(this.element)},t.prototype.setNavButtonsLabels=function(){},t}();e.CalendarPanelControl=a;var r=function(e){function n(t,n){e.call(this,t,n),this.element.classList.add("day-panel"),this.elementContent=document.createElement("DIV"),this.elementContent.className="calendar-panel-content",this.element.appendChild(this.elementContent),this._currentItem=new o(this,this.currentDate)}return __extends(n,e),Object.defineProperty(n.prototype,"currentDate",{get:function(){return this._currentDate},enumerable:!0,configurable:!0}),n.prototype.setNavButtonsLabels=function(){var t=WinJS.Resources.getString("mcncalendar.nextmonth.arialabel"),e=WinJS.Resources.getString("mcncalendar.previousmonth.arialabel");t.empty||e.empty||(this.parent.navbuttonNext.setAttribute("aria-label",t.value),this.parent.navbuttonPrevious.setAttribute("aria-label",e.value))},n.prototype.ensureValue=function(t,e){if(0!=moment(this.currentDate).diff(this._currentItem.currentDate))this.update(e,function(t){return WinJS.UI.Animation.drillInIncoming(t)},function(t){return WinJS.UI.Animation.drillInOutgoing(t)},t);else{$(".selected",this.element).removeClass("selected");var n="day-"+moment(this.parent.value).format("YYYY-MM-DD");$("#"+n,this.element).addClass("selected")}},n.prototype.update=function(t,e,n,i){this._currentItem.currentDate=moment(this._currentDate),this._currentItem.generateDays(t,e,n,i),this.parent.checkState()},n.prototype.next=function(e){this.allowNext()&&(this._currentDate=moment(this._currentDate).add(1,"M").toDate(),this.update(e,function(e){return t.UI.Animation.slideFromBottom(e,{duration:160})},function(e){return t.UI.Animation.slideToTop(e,{duration:160})}))},n.prototype.previous=function(e){this.allowPrevious()&&(this._currentDate=moment(this._currentDate).add(-1,"M").toDate(),this._currentItem.currentDate=moment(this._currentDate),this.update(e,function(e){return t.UI.Animation.slideFromTop(e,{duration:160})},function(e){return t.UI.Animation.slideToBottom(e,{duration:160})}))},n.prototype.allowNext=function(){if(!this.parent.maxdate)return!0;var t=moment(this._currentDate).add(1,"M").add(-1,"d").toDate();return t<moment(this.parent.maxdate).toDate()?!0:!1},n.prototype.allowPrevious=function(){return this.parent.mindate?this._currentDate>moment(this.parent.mindate).toDate()?!0:!1:!0},n}(a);e.CalendarDayPanelControl=r;var o=function(){function e(t,e){this.parent=t,this.currentDate=moment(new Date(e.getFullYear(),e.getMonth(),1)),this.element=document.createElement("DIV"),this.element.className="calendar-panel-item day-panel-item",this.element.id="month"+this.currentDate.toDate().toISOString(),this.parent.elementContent.appendChild(this.element),this.renderContent()}return e.prototype.enter=function(t){return(t=t||WinJS.UI.Animation.drillOutIncoming)(this.element)},e.prototype.renderContent=function(){var e=this,n=this.currentDate.clone().day(this.parent.parent.startDayOfWeek);this.element.innerHTML='<header role="button" tabIndex="0" data-win-focus=\'{ bottom: ".dayitem.tap" }\'>\n					<div class="month">'+this.currentDate.format("MMMM")+'</div>\n					<div class="year">'+this.currentDate.format("YYYY")+'</div>\n				</header>\n				<section class="day-items">\n					<header>\n					</header>\n					<section>\n					</section>\n				</section>',this.monthTxt=this.element.querySelector(".month"),this.yearTxt=this.element.querySelector(".year");var i=this.element.querySelector("header"),a=WinJS.Resources.getString("mcncalendar.daystitle.arialabel");a.empty||i.setAttribute("aria-label",a.value),t.UI.tap(i,function(){e.parent.parent.switchToMonth()}),this.header=this.element.querySelector(".day-items > header");for(var r=n.clone(),o=0;7>o;o++){var s=document.createElement("DIV");s.className="day-item day-header",s.innerText=r.format("ddd");var l=r.day();(0==l||6==l)&&s.classList.add("weekend"),this._lastdow=r.day(),r.add(1,"d"),this.header.appendChild(s)}this.content=this.element.querySelector(".day-items > section"),this.days=this.renderDaysWrapper(this.content)},e.prototype.destroyPanel=function(t){WinJS.Utilities.disposeSubTree(t),t.winControl.dispose(),t.parentElement.removeChild(t)},e.prototype.generateDays=function(t,e,n,i){var a=this;if(this.days){var r=this.days;i?this.destroyPanel(r):n(r).then(function(){a.destroyPanel(r)})}this.selected=null,this.days=this.renderDaysWrapper(this.content);var o=function(){if(t){var e=a.content.querySelector(".day-item.selected:not(:disabled)");e||(e=a.content.querySelector(".day-item.thismonth:not(:disabled)")),e&&e.focus()}};i?(this.monthTxt.innerText=this.currentDate.format("MMMM"),this.yearTxt.innerText=this.currentDate.format("YYYY"),o()):e(this.days).then(function(){a.monthTxt.innerText=a.currentDate.format("MMMM"),a.yearTxt.innerText=a.currentDate.format("YYYY"),o()})},e.prototype.renderDaysWrapper=function(e){var n=this,i=document.createElement("DIV");i.className="day-items-wrapper";var a=new t.UI.SwipeSlide(i,{direction:"vertical",allowed:{top:this.parent.allowNext(),bottom:this.parent.allowPrevious()}});return a.onswipe=function(t){a.swipeHandled=!0,"top"==t.direction?n.parent.next(!0):"bottom"==t.direction&&n.parent.previous(!0)},this.renderDays(i),e.appendChild(i),i},e.prototype.renderDays=function(t){var e=this,n=this.currentDate.clone().day(this.parent.parent.startDayOfWeek),i=this.currentDate.month(),a=this.parent.parent.value,r=moment(a).hour(0).minute(0).second(0).millisecond(0),o=(moment(this.parent.parent.value).hour(0).minute(0).second(0).millisecond(0),null),s=moment().hour(0).minute(0).second(0).millisecond(0);this.parent.parent.mindate&&(o=moment(this.parent.parent.mindate).hour(0).minute(0).second(0).millisecond(0));var l=null;this.parent.parent.maxdate&&(l=moment(this.parent.parent.maxdate).hour(0).minute(0).second(0).millisecond(0));var u=n.clone(),c=this.currentDate.clone().add(1,"M").add(-1,"d");c.day()!=this._lastdow&&c.day(this._lastdow+7);for(;c>=u;){var h=document.createElement("BUTTON");h.className="day-item tap",h.id="day-"+u.format("YYYY-MM-DD"),h.innerText=u.format("DD"),h.setAttribute("aria-label",u.format("L")),0==u.diff(s)&&h.classList.add("today"),a&&0==u.diff(r)&&(h.classList.add("selected"),this.selected=h);var d=u.day();(0==d||6==d)&&h.classList.add("weekend"),h.classList.add(u.month()!=i?"notthismonth":"thismonth"),o&&o>u&&(h.disabled=!0),l&&u>l&&(h.disabled=!0),h.mcnCalendarDay=u.clone(),h.onclick=function(t){var n=t.target.mcnCalendarDay;t.target.classList.add("selected"),e.selected&&e.selected.classList.remove("selected"),e.selected=t.target,e.parent.parent.value=n.toDate(),e.parent.parent.dispatchEvent("change")},u.add(1,"d"),t.appendChild(h)}},e.prototype.remove=function(e){var n=this;return e=e||WinJS.UI.Animation.drillOutOutgoing,this.element?e(this.element).then(function(){t.UI.untapAll(n.element),n.element.parentElement.removeChild(n.element),n.element=null}):WinJS.Promise.wrap()},e}();e.CalendarDayPanelContentControl=o;var s=function(e){function n(t,n){e.call(this,t,n),this.element.classList.add("month-panel"),this.renderContent()}return __extends(n,e),n.prototype.setNavButtonsLabels=function(){var t=WinJS.Resources.getString("mcncalendar.nextyear.arialabel"),e=WinJS.Resources.getString("mcncalendar.previousyear.arialabel");t.empty||e.empty||(this.parent.navbuttonNext.setAttribute("aria-label",t.value),this.parent.navbuttonPrevious.setAttribute("aria-label",e.value))},n.prototype.next=function(e){this.allowNext()&&(this._currentDate=moment(this._currentDate).add(1,"Y").toDate(),this.update(e,function(e){return t.UI.Animation.slideFromBottom(e,{duration:160})},function(e){return t.UI.Animation.slideToTop(e,{duration:160})}))},n.prototype.previous=function(e){this.allowPrevious()&&(this._currentDate=moment(this._currentDate).add(-1,"Y").toDate(),this.update(e,function(e){return t.UI.Animation.slideFromTop(e,{duration:160})},function(e){return t.UI.Animation.slideToBottom(e,{duration:160})}))},n.prototype.allowNext=function(){var t=new Date(this._currentDate.getFullYear(),11,31);return this.parent.maxdate?t<moment(this.parent.maxdate).toDate()?!0:!1:!0},n.prototype.allowPrevious=function(){var t=new Date(this._currentDate.getFullYear(),0,1);return this.parent.mindate?t>moment(this.parent.mindate).month(0).date(1).toDate()?!0:!1:!0},n.prototype.ensureValue=function(t,e){0!=moment(this._currentDate).diff(moment(this.renderedDate))&&this.update(e,function(t){return WinJS.UI.Animation.drillInIncoming(t)},function(t){return WinJS.UI.Animation.drillInOutgoing(t)},t)},n.prototype.update=function(t,e,n,i){var a=this,r=this.monthesPanel;i?r.parentElement.removeChild(r):n(this.monthesPanel).then(function(){r.parentElement.removeChild(r)}),this.monthesPanel=this.renderMonthPanel(this.content);var o=function(){if(t){var e=a.content.querySelector(".month-item.selected:not(:disabled)");e||(e=a.content.querySelector(".month-item:not(:disabled)")),e&&e.focus()}};i?(this.yearTxt.innerText=""+this._currentDate.getFullYear(),o()):e(this.monthesPanel).then(function(){a.yearTxt.innerText=""+a._currentDate.getFullYear(),o()}),this.parent.checkState()},n.prototype.renderContent=function(){this.element.innerHTML='<header>\n					<div class="year">'+this._currentDate.getFullYear()+'</div>\n				</header>\n				<section class="month-items">\n					\n				</section>',this.yearTxt=this.element.querySelector(".year"),this.content=this.element.querySelector(".month-items"),this.monthesPanel=this.renderMonthPanel(this.content)},n.prototype.renderMonthPanel=function(e){var n=this,i=document.createElement("DIV");i.className="month-itemspanel";var a=new t.UI.SwipeSlide(i,{direction:"vertical",allowed:{top:this.allowNext(),bottom:this.allowPrevious()}});a.onswipe=function(t){a.swipeHandled=!0,"top"==t.direction?n.next():"bottom"==t.direction&&n.previous()};var r=moment(new Date(this._currentDate.getFullYear(),0,1)),o=moment().hour(0).minute(0).second(0).millisecond(0),s=o.clone().date(1),l=null;this.parent.mindate&&(l=moment(this.parent.mindate).date(1).hour(0).minute(0).second(0).millisecond(0));var u=null;this.parent.maxdate&&(u=moment(this.parent.maxdate).date(1).hour(0).minute(0).second(0).millisecond(0));for(var c=0;12>c;c++){var h=document.createElement("BUTTON");h.className="month-item tap";var d=r.clone();h.mcnMonthDate=d,h.innerText=d.format("MMM"),h.setAttribute("aria-label",d.format("MMMM YYYY")),0==d.diff(s)?h.classList.add("today"):o>r&&h.classList.add("pastmonth"),l&&l>r&&(h.disabled=!0),u&&r>u&&(h.disabled=!0),h.onclick=function(t){var e=t.target,i=e.mcnMonthDate;n._currentDate=i.toDate(),n.parent.switchToDays()},i.appendChild(h),r.add(1,"M")}return e.appendChild(i),this.renderedDate=this._currentDate,i},n}(a);e.CalendarMonthPanelControl=s}(e=t.UI||(t.UI={}))}(WinJSContrib||(WinJSContrib={}));