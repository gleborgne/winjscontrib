/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var WinJSContrib=WinJSContrib||{};WinJSContrib.UI=WinJSContrib.UI||{},function(){"use strict";WinJSContrib.UI.MultiPassRenderer=WinJS.Class.define(function(e,t){t=t||{},this.items=[],this.element=e,this._scrollProcessor=null,this._tolerance=1,this._virtualize=!1,this._scrollContainer=t.scrollContainer||null,this._multipass=t.multipass||!1,this._orientation=t.orientation||"",this.itemClassName=t.itemClass||t.className||t.itemClassName,this.itemTemplate=WinJSContrib.Utils.getTemplate(t.template||t.itemTemplate),this.itemInvoked=t.invoked||t.itemInvoked,this.onitemContent=t.onitemContent,this._onScrollBinded=this._onScroll.bind(this),e&&(e.className=e.className+" mcn-items-ctrl mcn-layout-ctrl win-disposable")},{dispose:function(){var e=this;WinJSContrib.UI.untapAll(e.element),WinJS.Utilities.disposeSubTree(e.element),e._unregisterScrollEvents(),e._scrollContainer=null,e.element=null,e._scrollProcessor=null,e.rect=null,e.items=[]},clear:function(){var e=this;WinJS.Utilities.disposeSubTree(e.element),e.element.innerHTML=""},multipass:{get:function(){return this._multipass},set:function(e){this._multipass=e,this.refreshScrollEvents()}},tolerance:{get:function(){return this._tolerance},set:function(e){this._tolerance=e}},virtualize:{get:function(){return this._virtualize},set:function(e){this._virtualize=e}},orientation:{get:function(){return this._orientation},set:function(e){this._orientation=e,this.refreshScrollEvents()}},scrollContainer:{get:function(){return this._scrollContainer},set:function(e){this._unregisterScrollEvents(),this._scrollContainer=e,this._registerScrollEvents()}},_onScroll:function(){var e=this;e.scrollContainer&&e._scrollProcessor&&(e._scrollRequest&&cancelAnimationFrame(e._scrollRequest),e._scrollRequest=requestAnimationFrame(function(){e.checkRendering()}))},_unregisterScrollEvents:function(){this._scrollProcessor=null,this.clearOffsets(),this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this._onScrollBinded)},_registerScrollEvents:function(){var e=this;e.scrollContainer&&(this.scrollContainer.addEventListener("scroll",this._onScrollBinded),"vertical"==e.orientation?"section"==e.multipass?e._scrollProcessor=function(){e._checkSection(e._vIsInView)}:"item"==e.multipass&&(e._scrollProcessor=function(){e._checkItem(e._vIsInView)}):"section"==e.multipass?e._scrollProcessor=function(){e._checkSection(e._hIsInView)}:"item"==e.multipass&&(e._scrollProcessor=function(){e._checkItem(e._hIsInView)}))},refreshScrollEvents:function(){this._unregisterScrollEvents(),this._registerScrollEvents(),this.clearOffsets()},_vIsInView:function(e,t,n){var i=t.clientHeight*n;return e.y>=t.scrollTop-i&&e.y<=t.scrollTop+t.clientHeight+i?!0:e.y+e.height>=t.scrollTop-i&&e.y+e.height<=t.scrollTop+t.clientHeight+i?!0:e.y<=t.scrollTop-i&&e.y+e.height>=t.scrollTop+t.clientHeight+i?!0:!1},_hIsInView:function(e,t,n){var i=t.clientWidth*(n||0);return e.x>=t.scrollLeft-i&&e.x<=t.scrollLeft+t.clientWidth+i?!0:e.x+e.width>=t.scrollLeft-i&&e.x+e.width<=t.scrollLeft+t.clientWidth+i?!0:e.x<=t.scrollLeft-i&&e.x+e.width>=t.scrollLeft+t.clientWidth+i?!0:!1},clearOffsets:function(){var e=this;e.element&&(e.rect=null,e.items.forEach(function(e){e.rect=null}))},updateLayout:function(){var e=this;e.element&&e.refreshScrollEvents()},_checkSection:function(e,t,n){var i=this;if(i.element){if(t=t||0,!i.rect&&i.items&&i.items.length?i.rect=WinJSContrib.UI.offsetFrom(i.element,i.scrollContainer):(i.rect=i.rect||{x:0,y:0,width:0,height:0},i.rect.width=i.element.clientWidth,i.rect.height=i.element.clientHeight),e(i.rect,i.scrollContainer,t)){if(n)return!0;i.renderItemsContent(),i.onrendersection&&i.onrendersection()}else i.virtualize&&t>0&&i.items&&i.items.length&&i.items[0].rendered&&i.items.forEach(function(e){e.empty()});0==t&&i.tolerance>0&&setImmediate(function(){i._checkSection(e,i.tolerance)})}},_checkItem:function(e,t){var n=this;if(n.element){t=t||0;var i=!0;n._checkSection(e,t,!0)?(n.items.forEach(function(r){r.rect||(r.rect=WinJSContrib.UI.offsetFrom(r.element,n.scrollContainer)),i&=r.rendered,!r.rendered&&e(r.rect,n.scrollContainer,t)?r.render():r.rendered&&n.virtualize&&t>0&&!e(r.rect,n.scrollContainer,t)&&r.empty()}),n.allRendered=i):t>0&&n.items.length&&(n.items[0].rendered||n.items[n.items.length-1].rendered)&&n.items.forEach(function(i){i.rect||(i.rect=WinJSContrib.UI.offsetFrom(i.element,n.scrollContainer)),n.virtualize&&!e(i.rect,n.scrollContainer,t)&&i.empty()}),0==t&&n.tolerance>0&&setImmediate(function(){n._checkItem(e,n.tolerance)})}},prepareItems:function(e,t){var n=this;e=e||[],t=t||{};var i=(e.length,t.itemInvoked||n.itemInvoked);"string"==typeof i&&(i=WinJSContrib.Utils.resolveMethod(n.element,i));var r=WinJSContrib.Utils.getTemplate(t.template)||n.itemTemplate,l=t.itemClassName||n.itemClassName,o=t.onitemInit||n.onitemInit,s=t.onitemContent||n.onitemContent,c=n.element,m=n.items;e.forEach(function(e){var t=new WinJSContrib.UI.MultiPassItem(n,null,{data:e,template:r,className:l,itemInvoked:i,onitemInit:o,onitemContent:s});m.push(t),c.appendChild(t.element)}),(t.renderItems||!this.multipass)&&n.renderItemsContent()},checkRendering:function(){var e=this;e.element&&e._scrollProcessor&&e._scrollProcessor()},renderItemsContent:function(){var e=this;e.element&&(e.items.forEach(function(e){e.rendered||e.render()}),e.allRendered=!0)}}),WinJSContrib.UI.MultiPassItem=WinJS.Class.define(function(e,t,n){n=n||{};var i=this;i.renderer=e,i.element=t||document.createElement("DIV"),i.element.className=i.element.className+" "+n.className+" mcn-multipass-item unloaded win-disposable",i.element.winControl=i,i.itemInvoked=n.itemInvoked,i.itemDataPromise=WinJS.Promise.as(n.data),i.itemTemplate=n.template,i.rendered=!1,i.onitemContent=n.onitemContent,n.onitemInit&&n.onitemInit(this)},{dispose:function(){var e=this;e.renderer=null,e.element=null,e.itemInvoked=null,e.itemData=null,e.itemDataPromise=null,e.itemTemplate=null,e.onitemContent=null},render:function(e){var t=this;return t.element&&t.itemTemplate&&!t.rendered?(t.rendered=!0,t._renderContent()):WinJS.Promise.wrap(t.contentElement)},empty:function(){var e=this;e.element&&e.rendered&&(WinJSContrib.UI.untapAll(e.element),e.element.classList.remove("loaded"),e.element.innerHTML="",e.rendered=!1)},_renderItemContent:function(e){var t=this;if(t.element)return t.element.appendChild(e),t.itemInvoked&&("string"==typeof t.itemInvoked&&(t.itemInvoked=WinJSContrib.Utils.resolveMethod(t.element,t.itemInvoked)),t.itemInvoked&&WinJSContrib.UI.tap(t.element,function(e){t.itemInvoked(t)})),t.onitemContent?t.onitemContent(t.itemData,e):t.renderer.onitemContent&&t.renderer.onitemContent(t.itemData,e),setImmediate(function(){t.element&&(t.element.classList.remove("unloaded"),t.element.classList.add("loaded"))}),t.rendered=!0,t.contentElement=e,e},_renderContent:function(){var e=this;return e.element&&e.itemTemplate?e.itemDataPromise.then(function(t){return e.itemData=t,e.itemTemplate.render(t).then(function(t){e._renderItemContent(t)})}):WinJS.Promise.wrap()}})}();