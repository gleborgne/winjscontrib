/* 
 * WinJS Contrib v2.0.1.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){WinJS.Namespace.define("WinJSContrib.UI",{parentChildView:function(e){for(var t=e.parentNode;t;){if(t.mcnChildnav)return t.winControl;t=t.parentNode}},ChildViewFlyout:WinJS.Class.mix(WinJS.Class.define(function(e,t){e.winControl=this,t=t||{},this.element=e||document.createElement("div"),t.inplace?this.rootElement=this.element:(this.rootElement=document.createElement("div"),this.rootElement.mcnChildnav=!0,this.rootElement.winControl=this,this.element.style.display="none"),document.body.appendChild(this.rootElement),this.$element=$(e),this.element.mcnChildnav=!0,this.element.classList.add("mcn-childview"),this.element.classList.add("win-disposable"),this.rootElement.classList.add("childNavigator"),this.element.classList.add("mcn-navigation-ctrl"),this._createContent(),this.isOpened=!1,this.hardwareBackBtnPressedBinded=this.hardwareBackBtnPressed.bind(this)},{_createContent:function(){var e=this;this.overlay=document.createElement("div"),this.overlay.className="childNavigator-overlay",this.$overlay=$(this.overlay),this.$overlay.removeClass("visible"),this.rootElement.appendChild(this.overlay),this.$overlay.tap(function(){e.hide()},{disableAnimation:!0}),this.contentPlaceholder=document.createElement("div"),this.contentPlaceholder.className="childNavigator-contentPlaceholder";var t=document.createElement("DIV");this.contentPlaceholder.appendChild(t),this.navigator=new WinJSContrib.UI.PageControlNavigator(t,{global:!1}),this.navigator.hide=function(t){return e.hide(t)},this.$contentPlaceholder=$(this.contentPlaceholder),this.rootElement.appendChild(this.contentPlaceholder)},navigate:function(e,t){var n=this;return n.navigator.navigate(e,t)},pageControl:{get:function(){return this.container&&this.container.winControl}},clear:function(){var e=this;return new WinJS.Promise(function(t){WinJS.Promise.wrap(e.closePage()).done(function(){e.navigator.clear(),e.navigator._element.innerText="",e.location=void 0,t()})})},closePage:function(e,t){var n=this;return n.canClose()?(1==n.navigator._element.children.length&&n.hide(e),n.navigator.triggerPageExit(),n.navigator.closePage(t).then(function(){WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()})):WinJS.Promise.wrapError()},back:function(e){var t=this;return t.navigator.back(e)},canGoBack:function(){return that.navigator.canGoBack},_childContentKeyUp:function(e){"Esc"===e.key&&this.hide()},hardwareBackBtnPressed:function(e){var t=this,n=WinJSContrib.UI.FlyoutPage.openPages.indexOf(t);n==WinJSContrib.UI.FlyoutPage.openPages.length-1&&(t.hide(),e.handled=!0,e.preventDefault&&e.preventDefault())},show:function(e){var t=this;t.isOpened||(document.body.addEventListener("keyup",t.childContentKeyUp),t.isOpened=!0,$(t.rootElement).addClass("visible"),t.$overlay.addClass("visible"),e||t.$contentPlaceholder.addClass("visible"),t.navEventsHandler=WinJSContrib.UI.registerNavigationEvents(t,this.hardwareBackBtnPressedBinded))},pick:function(e,t,n){var i=this;return t=t||{},new WinJS.Promise(function(o){var a=!1,r=null,s=function(){r&&r.removeEventListener("closing",s),i.removeEventListener("beforehide",s),a||(a=!0,o({completed:!1,data:null}))};t.navigateStacked=!0,t.injectToPage={close:function(e){a=!0,r&&r.removeEventListener("closing",s),i.removeEventListener("beforehide",s),i.closePage(e,this.rootElement).then(function(){o({completed:!0,data:e})})},cancel:function(){s(),i.closePage()}},i.open(e,t,n).then(function(){r=i.navigator.pageControl,r&&r.addEventListener("closing",s),i.addEventListener("beforehide",s,!1)})})},open:function(e,t,n){var i=this;return $(i.rootElement).addClass("visible"),i.dispatchEvent("beforeshow"),i.$overlay.addClass("enter"),i.$contentPlaceholder.addClass("enter"),new WinJS.Promise(function(o,a){setImmediate(function(){i.$overlay.addClass("visible"),i.$contentPlaceholder.addClass("visible"),i.isOpened||i.show(!0),setImmediate(function(){i.navigate(e,t,n).done(function(e){i.dispatchEvent("aftershow"),o(e)},a)}),i.$contentPlaceholder.afterTransition(function(){i.$overlay.removeClass("enter"),i.$contentPlaceholder.removeClass("enter")})})})},canClose:function(){return this.navigator.pageControl&&this.navigator.pageControl.canClose&&!this.navigator.pageControl.canClose()?!1:!0},hide:function(e){var t=this;if(t.isOpened){if(!t.canClose())return!1;document.body.removeEventListener("keyup",t.childContentKeyUp),t.isOpened=!1,t.dispatchEvent("beforehide",e),t.navEventsHandler&&(t.navEventsHandler(),t.navEventsHandler=null),t.$overlay.removeClass("enter"),t.$contentPlaceholder.removeClass("enter"),t.$overlay.hasClass("visible")&&(t.$overlay.addClass("leave"),t.$contentPlaceholder.addClass("leave"),setImmediate(function(){t.$contentPlaceholder.afterTransition(function(){t.clear(),$(t.rootElement).removeClass("visible"),t.dispatchEvent("afterhide",e),t.$overlay.removeClass("leave"),t.$contentPlaceholder.removeClass("leave")}),t.$overlay.removeClass("visible"),t.$contentPlaceholder.removeClass("visible")}))}return!0},dispose:function(){this.rootElement.winControl=null,WinJS.Utilities.disposeSubTree(this.rootElement),WinJS.Utilities.disposeSubTree(this.element),$(this.rootElement).remove()}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("beforeshow","beforehide","aftershow","afterhide"))})}();