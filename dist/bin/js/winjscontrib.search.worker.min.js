/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var worker=this;!function(){"use strict";var n=null,i=new WinJSContrib.Messenger(worker,worker);i.init=function(i){return n=new WinJSContrib.Search.Index,n.name=i.name,n.definition=i.definition,i.load?n.load():void 0},i.save=function(i){return n.name&&n.definition?n.save():WinJS.Promise.wrapError({message:"index "+(n?n.name:"")+" not initialized"})},i.load=function(i){return n.name?n.load():WinJS.Promise.wrapError({message:"index "+(n?n.name:"")+" not initialized"})},i.count=function(i){return n.name&&n.definition?n.items.length:WinJS.Promise.wrapError({message:"index "+(n?n.name:"")+" not initialized"})},i.index=function(i){return new WinJS.Promise(function(e,o,t){try{if(i.options&&i.options.index&&(n.name=i.options.index.name,i.options.index.definition&&(n.definition=i.options.index.definition)),!n.name||!n.definition)return void o({message:"index "+(n?n.name:"")+" not initialized"});if(i.options&&i.options.load)var r=n.load();else var r=WinJS.Promise.wrap();r.done(function(){var r=n.addRange(i.items,null,t);i.options&&i.options.save?n.save().done(function(){e({name:n.name,items:r})},o):e({name:n.name,items:r})},o)}catch(a){o(a)}})},i.search=function(i){return new WinJS.Promise(function(e,o,t){try{if(i.options&&i.options.index&&(n.name=i.options.index.name,i.options.index.definition&&(n.definition=i.options.index.definition)),!n.name||!n.definition)return void o({message:"index "+(n?n.name:"")+" not initialized"});if(i.options&&i.options.load)var r=n.load();else var r=WinJS.Promise.wrap();r.done(function(){var o=n.search(i.searchTerm);e(o)},o)}catch(a){o(a)}})},i.clear=function(i){return n.name&&n.definition?n.clear():WinJS.Promise.wrapError({message:"index "+(n?n.name:"")+" not initialized"})}}();