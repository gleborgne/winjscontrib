<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>WinJS Contrib Source: winjscontrib.ui.hubcontrol.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">WinJS Contrib</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#WinJSContrib">WinJSContrib</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Alerts.html">Alerts</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Bindings.html">Bindings</a>
						</li>
						
						<li>
							<a href="WinJSContrib.CrossPlatform.html">CrossPlatform</a>
						</li>
						
						<li>
							<a href="WinJSContrib.CrossPlatform.isMobile.html">isMobile</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.html">Logging</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.Appenders.html">Appenders</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.html">Search</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.html">Stemming</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.Op.html">Op</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.StopWords.html">StopWords</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Templates.html">Templates</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.html">UI</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.Animation.html">Animation</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataForm.Converters.html">Converters</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataForm.defaultBindingOptions.html">defaultBindingOptions</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.html">DataSources</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.Grouping.html">Grouping</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.WebComponents.html">WebComponents</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Utils.html">Utils</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Utils.ValueParsers.html">ValueParsers</a>
						</li>
						
						<li>
							<a href="WinJSContrib.WinRT.html">WinRT</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="WinJSContrib.Logging.Appenders.ConsoleAppender.html">ConsoleAppender</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.LoggerClass.html">LoggerClass</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Messenger.html">Messenger</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Messenger.SmartWorker.html">SmartWorker</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Index.html">Index</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.IndexGroup.html">IndexGroup</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.IndexWorkerProxy.html">IndexWorkerProxy</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.Pipeline.html">Pipeline</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.ChildViewFlyout.html">ChildViewFlyout</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataForm.html">DataForm</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.DataSourceManager.html">DataSourceManager</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.ElasticInput.html">ElasticInput</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.EventTracker.html">EventTracker</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.ExtendedSplash.html">ExtendedSplash</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlipSnap.html">FlipSnap</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlipViewPager.html">FlipViewPager</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FluentDOM.html">FluentDOM</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlyoutPage.html">FlyoutPage</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.GlobalProgress.html">GlobalProgress</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.GridControl.html">GridControl</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.HubControl.html">HubControl</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MediaTrigger.html">MediaTrigger</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MultiPassItem.html">MultiPassItem</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MultiPassRenderer.html">MultiPassRenderer</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.PageControlNavigator.html">PageControlNavigator</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.SemanticListViews.html">SemanticListViews</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.SmartListLayout.html">SmartListLayout</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UPnP.UPnPDevice.html">UPnPDevice</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: winjscontrib.ui.hubcontrol.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">/* 
 * WinJS Contrib v2.1.0.2
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

/// &lt;reference path="../core/winjscontrib.core.js" />
(function () {
	"use strict";

	WinJS.Namespace.define("WinJSContrib.UI", {
		HubControl: WinJS.Class.define(
            /**
             * Hub control replacement intended to be used with {@link WinJSContrib.UI.GridControl}
             * @class WinJSContrib.UI.HubControl
             * @param {HTMLElement} element DOM element containing the control
             * @param {Object} options
             */
            function HubControl(element, options) {
            	var hub = this;
            	options = options || {};
            	hub.element = element;

            	hub.savestate = options.savestate != undefined ? options.savestate : true;
            	hub.scrollContainer = (options &amp;&amp; options.scrollContainer) ? options.scrollContainer : element;
            	hub.sectionsContainer = (options &amp;&amp; options.sectionsContainer) ? options.sectionsContainer : element.querySelector('.mcn-hub-surface');
            	if (!hub.sectionsContainer) {
            		hub.sectionsContainer = document.createElement('DIV');
            		hub.sectionsContainer.className = 'mcn-hub-surface';
            		while (element.children[0]) {
            			hub.sectionsContainer.appendChild(element.children[0]);
            		}
            		element.appendChild(hub.sectionsContainer);
            	}
            	hub.element.className = hub.element.className + ' mcn-hub-ctrl mcn-layout-ctrl win-disposable';
            	//hub.element.style.display = 'none';
            	hub.element.winControl = hub;
            	hub.sections = [];
            	hub.multipass = options.multipass;

            	hub.hubScrolledBind = hub.hubScrolled.bind(hub);
            	hub.rendering = { lastScroll: 0 };
            	hub.identifier = hub.element.id + "//" + hub.element.className;

            	var parent = WinJSContrib.Utils.getScopeControl(hub.element);
            	if (parent &amp;&amp; parent.pageLifeCycle) {
            		parent.pageLifeCycle.steps.layout.attach(function () {
            			hub.layout();
            		});

            		parent.pageLifeCycle.steps.ready.attach(function () {
            			if (hub.savestate)
            				hub.restoreCtrlState();

            			hub.prepare();
            		});
            	}
            	else if (parent &amp;&amp; parent.elementReady) {
            		parent.elementReady.then(function () {
            			parent.readyComplete.then(function () {
            				hub.layout();
            				if (hub.savestate)
            					hub.restoreCtrlState();

            				hub.prepare();
            			});
            		});
            	}
            },
            /**
             * @lends WinJSContrib.UI.HubControl.prototype
             */
            {
            	prepare: function () {
            		this.autoRegisterSections();
            	},

            	/**
                 * configure multipass rendering (for using in conjunction with {@link WinJSContrib.UI.GridControl}
                 */
            	multipass: {
            		get: function () {
            			return this._multipass;
            		},
            		set: function (val) {
            			this._multipass = val;
            		}
            	},

            	orientation: {
            		get: function () {
            			return this._orientation;
            		},
            		set: function (val) {
            			this._orientation = val;
            		}
            	},

            	autoRegisterSections: function () {
            		var hub = this;
            		hub.sections = [];
            		var sections = hub.scrollContainer.querySelectorAll('.mcn-hub-section');
            		for (var i = 0 ; i &lt; sections.length ; i++) {
            			var section = sections[i];
            			var sectionCtrl = section.winControl;
            			if (sectionCtrl) {
            				hub.sections.push(sectionCtrl);
            			}
            		}
            	},

            	registerSection: function (selector, parentElement) {
            		var sec = new Section(selector, parentElement);
            		this.sections.push(sec);
            		return sec;
            	},

            	layout: function (viewState) {
            		var hub = this;
            		hub.element.style.display = '';
            		var spacer = document.createElement('DIV');
            		spacer.className = 'mcn-hub-section-spacer';
            		hub.sectionsContainer.appendChild(spacer);

            		if (!hub.sections.length) {
            			hub.autoRegisterSections();
            		}

            		this.sections.forEach(function (section) {
            			section.hub = hub;
            			section.layout(viewState);
            			section._attachItemsControls();
            		});
            	},

            	_attachItemsControls: function () {
            		var hub = this;
            		hub.sections.forEach(function (section) {
            			section.hub = hub;
            			section._attachItemsControls();
            		});
            	},

            	renderItemsContent: function (forceRendering) {
            		var hub = this;
            		//console.log('render item content multipass:' + hub.multipass);
            		hub.rendering.size = {
            			width: hub.scrollContainer.clientWidth,
            			height: hub.scrollContainer.clientHeight
            		};

            		if (!hub.multipass) {
            			hub.sections.forEach(function (section) {
            				section.hub = hub;
            				section.renderItemsContent(forceRendering);
            			});
            		}
            	},

            	renderSection: function (section, sectionTemplate, hasTitle) {
            		var hub = this;
            		section.hub = hub;
            		return new WinJS.Promise(function (complete, error) {
            			var template = WinJSContrib.Utils.getTemplate(sectionTemplate);
            			if (template) {
            				var sectionElt = document.createElement('DIV');
            				if (hasTitle) {
            					sectionElt.className = 'mcn-hub-section-titled';
            				}

            				template.render(section).done(function (rendered) {
            					var sectionItem = new WinJSContrib.UI.HubSection(sectionElt);
            					while (rendered.children[0]) {
            						sectionElt.appendChild(rendered.children[0]);
            					}

            					hub.sectionsContainer.appendChild(sectionElt);
            					hub.sections.push(sectionItem);
            					complete(sectionItem);
            				});
            			}
            		});

            	},

            	removeSection: function (section) {
            		var hub = this;
            		var index = hub.sections.indexOf(val);
            		if (index > -1) {
            			hub.sections.splice(index, 1);
            		}
            	},

            	saveCtrlState: function () {
            		var hub = this;
            		var navigator = WinJSContrib.UI.parentNavigator(hub.element);
            		if (navigator) {
            			var history = navigator.history;
            			var state = history.current.state || { hub: {} };
            			if (!state.hub)
            				state.hub = {};

            			if (hub.scrollContainer) {
            				var hubdata = {};
            				hubdata.scrollLeft = hub.scrollContainer.scrollLeft;
            				hubdata.scrollTop = hub.scrollContainer.scrollTop;
            				state.hub[hub.identifier] = hubdata;
            			}
            			history.current.state = state;
            		}
            		return state;
            	},

            	restoreCtrlState: function (state) {
            		var hub = this;
            		var navigator = WinJSContrib.UI.parentNavigator(hub.element);
            		if (navigator) {
            			var history = navigator.history;
            			state = state || history.current.state || { hub: {} };
            			if (!state.hub)
            				state.hub = {};

            			if (hub.scrollContainer &amp;&amp; state.hub) {
            				var hubdata = state.hub[hub.identifier];
            				if (hubdata &amp;&amp; hubdata.scrollLeft) {
            					hub.scrollContainer.scrollLeft = hubdata.scrollLeft;
            				}
            				if (hubdata &amp;&amp; hubdata.scrollTop) {
            					hub.scrollContainer.scrollTop = hubdata.scrollTop;
            				}
            			}
            		}
            	},

            	hubScrolled: function () {
            		if (!this.rendering.size) {
            			this.rendering.size = {
            				width: this.scrollContainer.clientWidth,
            				height: this.scrollContainer.clientHeight
            			};
            		}
            		var curScroll = this.scrollContainer.scrollLeft || this.scrollContainer.scrollTop;
            		var curScrollDelta = Math.abs(curScroll - this.rendering.lastScroll);
            		if (curScrollDelta > this.multipassStrategy.scrollOffset) {
            			this.multipassStrategy.processSections(this);
            			this.rendering.lastScroll = curScroll;
            		}

            	},

            	exitPage: function () {
            		if (this.savestate)
            			this.saveCtrlState();
            	},

            	updateLayout: function (element, viewState, lastViewState) {
            		var hub = this;
            		var state = {
            			w: hub.scrollContainer.clientWidth,
            			h: hub.scrollContainer.clientHeight,
            		}

            		if (hub.LastLayoutState &amp;&amp; (hub.LastLayoutState.w != state.w || hub.LastLayoutState.h != state.h)) {
            			hub.scrollContainer.scrollLeft = 0;
            			hub.scrollContainer.scrollTop = 0;
            		}

            		hub.LastLayoutState = state;
            	},

            	dispose: function () {
            		var hub = this;
            		hub.scrollContainer.removeEventListener('scroll', hub.hubScrolledBind);
            		if (WinJS.Utilities.disposeSubTree)
            			WinJS.Utilities.disposeSubTree(this.element);
            	}
            })
	});

	WinJS.Namespace.define("WinJSContrib.UI", {
		HubSection: WinJS.Class.define(
            function HubSection(element, options) {
            	var section = this;
            	options = options || {};
            	section.element = element || document.createElement('DIV');
            	section.element.winControl = section;
            	section.element.className = section.element.className + ' mcn-hub-section win-disposable';
            	section.onlayout = options.onlayout;

            	//var hub = WinJSContrib.Utils.getParentControlByClass('mcn-hub-ctrl', section.element);
            	//if (hub) {
            	//	if (hub.sections.indexOf(this) &lt;= 0) {
            	//		hub.sections.push(this);
            	//	}
            	//}
            }, {
            	layout: function (viewState) {
            		var section = this;
            		var layoutctrls = section.element.querySelectorAll('.mcn-layout-ctrl');
            		if (layoutctrls &amp;&amp; layoutctrls.length) {
            			for (var i = 0 ; i &lt; layoutctrls.length ; i++) {
            				var ctrl = layoutctrls[i].winControl;
            				if (ctrl) {
            					ctrl.multipass = ctrl.multipass || section.multipass;
            					//if (ctrl.layout)
            					//    ctrl.layout();
            				}
            			}
            		}

            		//section.items = [];
            		//var allitems = section.element.querySelectorAll('.mcn-multipass-item');
            		//var numitems = allitems.length;
            		//for (var i = 0 ; i &lt; numitems ; i++) {
            		//    var itemCtrl = allitems[i].winControl;
            		//    if (itemCtrl)
            		//        section.items.push(itemCtrl);
            		//}

            		if (section.onlayout) {
            			section.onlayout(viewState);
            		}
            	},

            	_attachItemsControls: function () {
            		var section = this;
            		var itemsctrls = this.element.querySelectorAll('.mcn-items-ctrl');
            		if (itemsctrls &amp;&amp; itemsctrls.length) {
            			for (var i = 0 ; i &lt; itemsctrls.length ; i++) {
            				var ctrl = itemsctrls[i].winControl;
            				if (ctrl) {
            					ctrl.multipass = section.hub.multipass;
            					if (ctrl.scrollContainer == undefined)
            						ctrl.scrollContainer = section.hub.scrollContainer;
            				}
            			}
            		}
            	},

            	renderItemsContent: function () {
            		var itemsctrls = this.element.querySelectorAll('.mcn-items-ctrl');
            		if (itemsctrls &amp;&amp; itemsctrls.length) {
            			for (var i = 0 ; i &lt; itemsctrls.length ; i++) {
            				var ctrl = itemsctrls[i].winControl;
            				if (ctrl &amp;&amp; ctrl.renderItemsContent)
            					ctrl.renderItemsContent();
            			}
            		}
            	},

            	dispose: function () {
            		if (WinJS.Utilities.disposeSubTree)
            			WinJS.Utilities.disposeSubTree(this.element);
            	}
            })
	});

	if (WinJSContrib.UI.WebComponents) {
		WinJSContrib.UI.WebComponents.register('mcn-hub', WinJSContrib.UI.HubControl, {
			properties: ['multipass']
		});

		WinJSContrib.UI.WebComponents.register('mcn-hub-section', WinJSContrib.UI.HubSection, {
			properties: []
		});
	}

})();</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					by MCNEXT
					<br />
					
					
		<span class="copyright">
		copyright MCNEXT
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Tue Jul 07 2015 08:57:14 GMT+0200 (Paris, Madrid (heure d’été)) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
